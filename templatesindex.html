<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>KiÃªn Chat ğŸ’¬</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
</head>
<body>
    <div id="chat-box">
        <h2>ğŸ”¥ KienVNNN Chat</h2>
        <div id="messages"></div>

        <div id="input-area">
            <input id="message-input" type="text" placeholder="Nháº­p tin nháº¯n..." autocomplete="off">
            <button id="send-btn">Gá»­i</button>
        </div>
    </div>

    <script>
        const socket = io();
        const msgBox = document.getElementById("messages");
        const input = document.getElementById("message-input");
        const sendBtn = document.getElementById("send-btn");

        function addMessage(msg) {
            const div = document.createElement("div");
            div.classList.add("msg");
            div.innerHTML = `
                <span>${msg.text}</span>
                <button class="del" onclick="deleteMessage(${msg.id})">ğŸ—‘ï¸</button>
            `;
            msgBox.prepend(div);
        }

        // Táº£i tin nháº¯n cÅ©
        fetch("/api/messages").then(r => r.json()).then(data => {
            data.reverse().forEach(addMessage);
        });

        // Gá»­i tin nháº¯n
        sendBtn.onclick = () => {
            const text = input.value.trim();
            if (text) {
                socket.emit("send_message", { text });
                input.value = "";
            }
        };

        // Nháº­n tin nháº¯n má»›i
        socket.on("new_message", msg => addMessage(msg));

        // Nháº­n tÃ­n hiá»‡u xÃ³a
        socket.on("delete_message", data => {
            const all = document.querySelectorAll(".msg");
            all.forEach(div => {
                if (div.innerHTML.includes(`deleteMessage(${data.id})`)) div.remove();
            });
        });

        // HÃ m xÃ³a tin nháº¯n
        function deleteMessage(id) {
            fetch(`/api/delete/${id}`, { method: "DELETE" });
        }
    </script>
</body>
</html>
